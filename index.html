<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
  <canvas id="bg-canvas"></canvas>
  <!-- Ø§Ù„ÙƒØ§Ù†ÙØ³ Ù„Ù„Ø®Ù„ÙÙŠØ© -->
  <div class="container">
    <h2>ğŸ“š Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
    <div id="msg" class="msg"></div>
    <input type="text" id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨..." class="search-bar">

    <div class="stats">
      <div>ğŸ“Œ Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨: <span id="totalStudents">0</span></div>
      <div>ğŸ“Š Ø£Ø¹Ù„Ù‰ Ø¹Ø±Ø¨ÙŠ: <span id="maxArabic">-</span> | Ù…ØªÙˆØ³Ø·: <span id="avgArabic">-</span></div>
      <div>ğŸ“Š Ø£Ø¹Ù„Ù‰ Ø±ÙŠØ§Ø¶ÙŠØ§Øª: <span id="maxMath">-</span> | Ù…ØªÙˆØ³Ø·: <span id="avgMath">-</span></div>
      <div>ğŸ“Š Ø£Ø¹Ù„Ù‰ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ: <span id="maxEnglish">-</span> | Ù…ØªÙˆØ³Ø·: <span id="avgEnglish">-</span></div>
      <div>ğŸ“Š Ø£Ø¹Ù„Ù‰ Ø¹Ù„ÙˆÙ…: <span id="maxScience">-</span> | Ù…ØªÙˆØ³Ø·: <span id="avgScience">-</span></div>
    </div>

    <form id="gradeForm">
      <input type="text" id="studentName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨" required>
      <input type="number" id="arabicGrade" placeholder="Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠ" min="0" max="100" required>
      <input type="number" id="mathGrade" placeholder="Ø¯Ø±Ø¬Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª" min="0" max="100" required>
      <input type="number" id="englishGrade" placeholder="Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ" min="0" max="100" required>
      <input type="number" id="scienceGrade" placeholder="Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¹Ù„ÙˆÙ…" min="0" max="100" required>
      <button type="submit">â• Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„</button>
    </form>

    <table>
      <thead>
        <tr>
          <th>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
          <th>Ø¹Ø±Ø¨ÙŠ</th>
          <th>Ø±ÙŠØ§Ø¶ÙŠØ§Øª</th>
          <th>Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ</th>
          <th>Ø¹Ù„ÙˆÙ…</th>
          <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
          <th>Ø§Ù„ØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…</th>
          <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
        </tr>
      </thead>
      <tbody id="gradesTable"></tbody>
    </table>

    <canvas id="chartCanvas" width="400" height="200"></canvas>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC0oOW5IRNm7TBpSJi-WL5_BIlcQDOe5WY",
      authDomain: "any-thing-93729.firebaseapp.com",
      databaseURL: "https://any-thing-93729-default-rtdb.firebaseio.com/",
      projectId: "any-thing-93729",
      storageBucket: "any-thing-93729.appspot.com",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    const gradeForm = document.getElementById('gradeForm');
    const gradesTable = document.getElementById('gradesTable');
    const msg = document.getElementById('msg');

    const inputs = {
      name: document.getElementById('studentName'),
      arabic: document.getElementById('arabicGrade'),
      math: document.getElementById('mathGrade'),
      english: document.getElementById('englishGrade'),
      science: document.getElementById('scienceGrade')
    };

    function calcResult(g) {
      if (g >= 90) return 'Ù…Ù…ØªØ§Ø²';
      if (g >= 80) return 'Ø¬ÙŠØ¯ Ø¬Ø¯Ù‹Ø§';
      if (g >= 60) return 'Ø¬ÙŠØ¯';
      if (g >= 50) return 'Ù…Ù‚Ø¨ÙˆÙ„';
      return 'Ø±Ø§Ø³Ø¨';
    }

    function showMsg(message, isError = false) {
      msg.textContent = message;
      msg.className = isError ? 'msg error' : 'msg';
      setTimeout(() => { msg.textContent = ''; }, 2000);
    }

    function resetForm() {
      gradeForm.reset();
      gradeForm.removeAttribute('data-key');
    }

    // Ø±Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø¯ÙˆÙ† Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ø¬ÙˆÙ…
    function renderTable(students) {
      gradesTable.innerHTML = '';
      if (students.length === 0) {
        gradesTable.innerHTML = '<tr><td colspan="7">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>';
        return;
      }
      students.forEach(entry => {
        // Ù„Ø§ Ù†Ø¬ÙˆÙ… ÙˆÙ„Ø§ ØªÙ…ÙŠÙŠØ² ØµÙÙˆÙ
        const cellClass = (result) => result === 'Ù…Ù…ØªØ§Ø²' ? 'excellent-cell' : '';
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©
        const total = entry.subjects.arabic.grade + entry.subjects.math.grade + entry.subjects.english.grade + entry.subjects.science.grade;
        const percent = ((total / 400) * 100).toFixed(2);
        const percentClass = percent >= 90 ? 'percent-high' : percent >= 80 ? 'percent-good' : '';
        const row = `<tr data-key="${entry.key}">
          <td>${entry.name}</td>
          <td class="${cellClass(entry.subjects.arabic.result)}">${entry.subjects.arabic.grade} (${entry.subjects.arabic.result})</td>
          <td class="${cellClass(entry.subjects.math.result)}">${entry.subjects.math.grade} (${entry.subjects.math.result})</td>
          <td class="${cellClass(entry.subjects.english.result)}">${entry.subjects.english.grade} (${entry.subjects.english.result})</td>
          <td class="${cellClass(entry.subjects.science.result)}">${entry.subjects.science.grade} (${entry.subjects.science.result})</td>
          <td class="${percentClass}">${percent}%</td>
          <td>
            <button class="delete-btn">Ø­Ø°Ù</button>
          </td>
        </tr>`;
        gradesTable.innerHTML += row;
      });
    }

    function updateStats(data) {
      const subjects = ['arabic', 'math', 'english', 'science'];
      document.getElementById('totalStudents').textContent = data.length;
      subjects.forEach(sub => {
        const grades = data.map(s => s.subjects[sub].grade);
        const max = grades.length ? Math.max(...grades) : '-';
        const avg = grades.length ? (grades.reduce((a,b)=>a+b,0)/grades.length).toFixed(1) : '-';
        document.getElementById('max' + capitalize(sub)).textContent = max;
        document.getElementById('avg' + capitalize(sub)).textContent = avg;
      });
    }

    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }

    function fetchData() {
      database.ref('grades').on('value', snap => {
        const val = snap.val();
        const list = [];
        for (const key in val) {
          list.push({ key, ...val[key] });
        }
        renderTable(list);
        updateStats(list);
        renderChart(list);
        window.allStudents = list;
      });
    }

    function renderChart(data) {
      const labels = data.map(s => s.name);
      const values = data.map(s => {
        const g = s.subjects;
        return (g.arabic.grade + g.math.grade + g.english.grade + g.science.grade) / 4;
      });
      new Chart(document.getElementById('chartCanvas'), {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¹Ø§Ù…',
            data: values,
            backgroundColor: '#273c75'
          }]
        },
        options: { responsive: true, plugins: { legend: { display: false } } }
      });
    }

    function editStudent(key) {
      const student = window.allStudents.find(s => s.key === key);
      if (!student) return;
      gradeForm.setAttribute('data-key', key);
      inputs.name.value = student.name;
      ['arabic','math','english','science'].forEach(sub => {
        inputs[sub].value = student.subjects[sub].grade;
      });
    }

    function deleteStudent(key) {
      if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ')) {
        database.ref('grades/' + key).remove();
        showMsg('ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­');
      }
    }

    gradeForm.addEventListener('submit', e => {
      e.preventDefault();
      const key = gradeForm.getAttribute('data-key');
      const name = inputs.name.value.trim();
      if (!name) return showMsg('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…', true);

      const subjects = {};
      ['arabic','math','english','science'].forEach(sub => {
        const g = Number(inputs[sub].value);
        subjects[sub] = { grade: g, result: calcResult(g) };
      });

      const data = { name, subjects };
      const ref = key ? database.ref('grades/' + key) : database.ref('grades').push();
      ref.set(data, err => {
        if (err) showMsg('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸', true);
        else showMsg('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­');
        resetForm();
      });
    });

    document.getElementById('searchInput').addEventListener('input', function() {
      const q = this.value.trim();
      if (!q) return renderTable(window.allStudents);
      const filtered = window.allStudents.filter(s => s.name.includes(q));
      renderTable(filtered);
    });

    fetchData();
  </script>
  <script>
    // Animation background: Ù†Ù‚Ø§Ø· ÙˆØ®Ø·ÙˆØ· ØªØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø§ÙˆØ³
    const bgCanvas = document.getElementById('bg-canvas');
    const ctx = bgCanvas.getContext('2d');
    let width = window.innerWidth;
    let height = window.innerHeight;
    bgCanvas.width = width;
    bgCanvas.height = height;
    bgCanvas.style.position = 'fixed';
    bgCanvas.style.top = 0;
    bgCanvas.style.left = 0;
    bgCanvas.style.zIndex = 0;
    bgCanvas.style.pointerEvents = 'none';
    bgCanvas.style.width = '100vw';
    bgCanvas.style.height = '100vh';
    document.body.style.position = 'relative';
    // Ù†Ù‚Ø§Ø·
    const POINTS = 100;
    const DIST = 200; // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø³Ø§ÙØ© Ù„Ø²ÙŠØ§Ø¯Ø© ÙƒØ«Ø§ÙØ© Ø§Ù„Ø®Ø·ÙˆØ·
    const points = [];
    for (let i = 0; i < POINTS; i++) {
      points.push({
        x: Math.random() * width,
        y: Math.random() * height,
        vx: (Math.random() - 0.5) * 0.7,
        vy: (Math.random() - 0.5) * 0.7
      });
    }
    let mouse = { x: width/2, y: height/2 };
    window.addEventListener('mousemove', e => {
      mouse.x = e.clientX;
      mouse.y = e.clientY;
    });
    window.addEventListener('resize', () => {
      width = window.innerWidth;
      height = window.innerHeight;
      bgCanvas.width = width;
      bgCanvas.height = height;
    });
    function draw() {
      ctx.clearRect(0, 0, width, height);
      // Ø±Ø³Ù… Ø§Ù„Ø®Ø·ÙˆØ·
      for (let i = 0; i < POINTS; i++) {
        for (let j = i + 1; j < POINTS; j++) {
          const dx = points[i].x - points[j].x;
          const dy = points[i].y - points[j].y;
          const dist = Math.sqrt(dx*dx + dy*dy);
          if (dist < DIST) {
            ctx.strokeStyle = `rgba(120,170,255,${0.18 + 0.7 * (1 - dist/DIST)})`;
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(points[i].x, points[i].y);
            ctx.lineTo(points[j].x, points[j].y);
            ctx.stroke();
          }
        }
        // Ø®Ø· Ù„Ù„Ù…Ø§ÙˆØ³
        const dxm = points[i].x - mouse.x;
        const dym = points[i].y - mouse.y;
        const distm = Math.sqrt(dxm*dxm + dym*dym);
        if (distm < DIST) {
          ctx.strokeStyle = `rgba(120,170,255,${0.25 + 0.7 * (1 - distm/DIST)})`;
          ctx.lineWidth = 1.2;
          ctx.beginPath();
          ctx.moveTo(points[i].x, points[i].y);
          ctx.lineTo(mouse.x, mouse.y);
          ctx.stroke();
        }
      }
      // Ø±Ø³Ù… Ø§Ù„Ù†Ù‚Ø§Ø·
      for (let i = 0; i < POINTS; i++) {
        ctx.beginPath();
        ctx.arc(points[i].x, points[i].y, 3, 0, 2 * Math.PI);
        ctx.fillStyle = '#7ab7ff';
        ctx.fill();
      }
    }
    function update() {
      for (let i = 0; i < POINTS; i++) {
        points[i].x += points[i].vx;
        points[i].y += points[i].vy;
        if (points[i].x < 0 || points[i].x > width) points[i].vx *= -1;
        if (points[i].y < 0 || points[i].y > height) points[i].vy *= -1;
      }
    }
    function animate() {
      update();
      draw();
      requestAnimationFrame(animate);
    }
    animate();
  </script>
</body>
</html>
